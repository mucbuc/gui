if (typeof EventStream === 'undefined') {
  EventStream = require( 'eventstream' ).EventStream;
}

(function( EventStream ) {

  function RootController() {
    
    var model = null;
    
    EventStream.call( this );

    this.__defineSetter__( 'model', function( m ) {
      if (model) {
        this.onTickEmit( 'unload' );  
      }
      model = m;
      this.onTickEmit( 'load' );
  	} );
  
    this.__defineGetter__( 'model', function() {
      return model;
    } );
  }

  RootController.prototype = new EventStream();
    
  function Controller( root, sub ) {
  
    for (method in RootController.prototype) {
      this[method] = root[method];
    }
    this.context = root.context; 

    this.__defineGetter__( 'click', function() {
      return root.click;
    } );
    
    this.__defineSetter__( 'model', function( v ) {
      root.model[ sub ] = v;
      root.onTickEmit( 'update' );
    } );
    
    this.__defineGetter__( 'model', function() {
      return root.model[ sub ];
    } );
  }
  
  exports.RootController = RootController;
  exports.Controller = Controller;

})( EventStream );

