if (typeof Builder === 'undefined') {
  Builder = require( 'builder' ).Builder;
}

(function(Builder) {
  
  function View( controller ) {

    var instance = this
      , elements; 

    Element.call( this, controller );

    this.buildComposite = function( factory ) {
      var builder = new Builder( factory );
      this.composite = builder.buildComposite( controller );
      elements = null;
    };

    this.forEach = function( f ) {
      this.elements.forEach( function( element ) {
        f( element );
      });
    };

   this.pinLeft = function( left ) {
      View.prototype.pinLeft.call( this, left );
      this.forEach( function( element) {
        element.pinLeft( left );
      } );
    };

    this.pinRight = function( right ) {
      View.prototype.pinRight.call( this, right );
      this.forEach( function( element ) { 
        element.pinRight( right );
      });
    };

    this.pinTop = function( top ) {
      View.prototype.pinTop.call( this, top );
      this.forEach( function( element ) { 
        element.pinTop( top );
      });
    };

    this.pinBottom = function( bottom ) {
      View.prototype.pinTop.call( this, bottom );
      this.forEach( function( element ) { 
        element.pinBottom( bottom );
      });
    };

    this.fillLeft = function( right, width ) {
      var cellWidth = width / this.elements.length;
      this.forEach( function( element ) {
        element.pinRight( right );
        right -= cellWidth 
        element.pinLeft( right );
      });
    };

    this.fillRight = function( left, width ) {
      var cellWidth = width / this.elements.length;
      this.forEach( function( element ) {
        element.pinLeft( left );
        left += cellWidth;
        element.pinRight( left );
      });
    };

    this.fillDown = function( top, height ) {
      var cellHeight = height / this.elements.length;
      this.forEach( function( element ) {
        element.pinTop( top );
        top += cellHeight; 
        element.pinBottom( top );
      });
    };

    this.fillUp = function( bottom, height ) {
      var cellHeight = height / this.elements.length;
      this.forEach( function( element ) {
        element.pinBottom( bottom );
        bottom -= cellHeight;
        element.pinTop( bottom );
      });
    };

    this.floatLeft = function( right ) {
      this.forEach( function( element ) {
        right -= element.floatLeft( right ); 
      });
    };

    this.floatRight = function( left ) {
      this.forEach( function( element ) {
        left += element.floatRight( left );
      });
    };

    this.floatDown = function( top ) {
      this.forEach( function( element ) {
        top += element.floatDown( top );
      });
    };

    this.floatUp = function( bottom ) {
      this.forEach( function( element ) {
        bottom -= element.floatUp( bottom );
      });
    };

    this.__defineGetter__( 'elements', function() {
      if (elements) {
        return elements;
      }
      elements = [];
      for (var type in this.composite) {
        var component = this.composite[type];
        if (component instanceof Array) {
          component.forEach( function( element ) {
            elements.push( element );

         } );
        } 
        else {
          elements.push( component );
        }
      }
      return elements;
    } );
  }

  View.prototype = new Element();

  exports.View = View;

})(Builder);



/*
    this.layoutDown = function( top ) {

      for (var type in this.composite) {
        var component = this.composite[type];
        if (component instanceof Array) {
          component.forEach( function( element ) {
            top = element.layoutDown( top );
          } );
        } 
        else {
          top = component.layoutDown( top );
        }
      }

      return top;
    };

    this.layoutStack = function( left, top ) {

      for (var type in this.composite) {
        
        var component = this.composite[type];

        if (component instanceof Array) {
          component.forEach( function( element ) {
            element.layoutDown( top );
            element.layoutRight( left );
         } );
        } 
        else {
          component.layoutDown( top );
          component.layoutRight( left );
        }
      }
    };

    this.fillStack = function( left, top, right, bottom ) {
      for (var type in this.composite) {
        
        var component = this.composite[type];

        if (component instanceof Array) {
          component.forEach( function( element ) {
            element.fillDown( top, bottom );
            element.fillRight( left, right );
         } );
        } 
        else {
          component.fillDown( top, bottom );
          component.fillRight( left, right );
        }
      }
    };
*/