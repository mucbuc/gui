<html>
<head>
<title>GUIFramework</title>

<script> var exports = this; </script>

<script src = 'public/javascripts/node_modules/set.js'></script>
<script src = 'public/javascripts/node_modules/eventstream.js'></script>
<script src = 'public/javascripts/node_modules/controller.js'></script>
<script src = 'public/javascripts/node_modules/factory.js'></script>
<script src = 'public/javascripts/node_modules/builder.js'></script>
<script src = 'public/javascripts/node_modules/utils.js'></script>
<script src = 'public/javascripts/node_modules/vec.js'></script>
<script src = 'public/javascripts/node_modules/rect.js'></script>
<script src = 'public/javascripts/node_modules/element.js'></script>
<script src = 'public/javascripts/node_modules/view.js'></script>
<script src = 'public/javascripts/node_modules/gui.js'></script>

<script src = 'public/javascripts/elements/clickrect.js'></script>
<script src = 'public/javascripts/elements/label.js'></script>
<script src = 'public/javascripts/elements/icon.js'></script>
<script src = 'public/javascripts/elements/frame.js'></script>
<script src = 'public/javascripts/elements/textbox.js'></script>
<script src = 'public/javascripts/elements/checkbox.js'></script>

<script src = 'public/javascripts/views/stack.js'></script>
<script src = 'public/javascripts/views/button.js'></script>
<script src = 'public/javascripts/views/row.js'></script>
<script src = 'public/javascripts/views/debug.js'></script>
<script src = 'public/javascripts/views/pretty.js'></script>

<script src = 'public/strings/english.js'></script>
<script src = 'public/strings/german.js'></script>

<script src = 'public/javascripts/canvas.js'></script>
<script src = 'public/javascripts/game.js'></script>
<script src = 'public/javascripts/logic.js'></script>
<script src = 'public/javascripts/app.js'></script>
<script type="text/javascript">

var context = null
  , clientBounds = null;

function MouseEvent(handler, ev)
{
	var x, y;
	
	// Get the mouse position relative to the canvas element.
	if (typeof ev.x === 'undefined') { // Firefox
		x = ev.pageX;
		y = ev.pageY;
	} else 
    { 
    	x = ev.x + window.scrollX;
        y = ev.y + window.scrollY;
	}
    handler( x - clientBounds.left, y - clientBounds.top );
}

function Init()
{
    var canvas = document.getElementById("maincanvas");
    context = canvas.getContext("2d");
	
    canvas.addEventListener('mousedown', app.onMouseDown, false );    //	MouseEvent.bind(null, app.onMouseDown), false);	
	  canvas.addEventListener('mouseup', app.onMouseUp, false );       // 	MouseEvent.bind(null, app.onMouseUp), false);	
	  canvas.addEventListener('mousemove', app.onMouseMove, false );   // MouseEvent.bind(null, app.onMouseMove), false);	

    clientBounds = canvas.getBoundingClientRect();

    app.init();
    app.gui = new Gui( document.getElementById("click"), canvas, context );
    app.gui.onTickEmit( 'pauseGame' );

	  logic.init(app.gui);

    setInterval( app.update, 20);
}

function SetDrawTextContext(color, size, bold ) {  
    boldText = "";
    if (bold)
    {
        boldText = "bold";
    }
    context.textBaseline = 'bottom';
    context.font = boldText + (size.toString() + "px Arial");
    context.fillStyle = color;
}

function DrawText(x, y, color, text, size, bold, width)     
{
    SetDrawTextContext(color, size, bold );
    context.fillText(text, x, y, width );
}

</script>
</head>
<body onload="Init();">
<canvas id="maincanvas" width="400" height="400"></canvas>
<audio src='public/audio/click02.wav' id="click"></audio>
</body>
</html>
